export type PersonalityProfile = {
  name: string;
  description: string;
  keywords: string[];
};

export const personalityProfiles: PersonalityProfile[] = [
  { name: 'Технологический философ', description: 'Соединяет технологии, философию, историю идей и размышляет о будущем человека.', keywords: ['технологии', 'технологический', 'философия', 'этика', 'история', 'будущее', 'ai'] },
  { name: 'Социальный исследователь', description: 'Изучает общество, культуру и психологию людей, ищет закономерности в социуме.', keywords: ['социология', 'общество', 'культура', 'психология', 'политика'] },
  { name: 'Научный инноватор', description: 'Работает с исследованиями, данными и экспериментами, ценит проверенные знания.', keywords: ['наука', 'исследование', 'данные', 'инновации', 'эксперимент'] },
  { name: 'Эко-активист', description: 'Заботится об устойчивом развитии, экологии и будущем планеты.', keywords: ['экология', 'sustainability', 'климат', 'окружение', 'зелёный'] },
  { name: 'Предприниматель', description: 'Создаёт продукты, бизнесы и ищет новые возможности для роста.', keywords: ['бизнес', 'стартап', 'предпринимательство', 'экономика', 'маркетинг'] },
  { name: 'Арт-куратор', description: 'Собирает художественные контексты: дизайн, визуальная культура, музыка и творчество.', keywords: ['арт', 'искусство', 'дизайн', 'креатив', 'визуал'] },
  { name: 'Финансовый аналитик', description: 'Думает цифрами: инвестиции, рынки, капитал и стратегии управления рисками.', keywords: ['финансы', 'инвестиции', 'рынок', 'экономика', 'капитал'] },
  { name: 'Психолог', description: 'Разбирается в поведении человека, мышлении и эмоциях.', keywords: ['психология', 'когниция', 'мышление', 'поведение', 'эмоции'] },
  { name: 'Стратег', description: 'Выстраивает долгосрочные сценарии, процессы и лидерство.', keywords: ['стратегия', 'лидерство', 'менеджмент', 'управление', 'процессы'] },
  { name: 'Гуманист', description: 'Фокусируется на этике, правах человека и философии.', keywords: ['гуманизм', 'этика', 'права человека', 'право', 'философия'] },
  { name: 'Медиатор культур', description: 'Соединяет языки, путешествия и культурные коды разных стран.', keywords: ['путешествия', 'языки', 'культура', 'этнография', 'география'] },
  { name: 'Техно-архитектор', description: 'Делает инфраструктуру, DevOps и инструменты для разработки.', keywords: ['devops', 'инфраструктура', 'архитектура', 'опенсорс', 'инструменты'] },
  { name: 'Образовательный дизайнер', description: 'Создаёт методологии, курсы и учебные продукты.', keywords: ['образование', 'обучение', 'методология', 'курсы', 'менторство'] },
  { name: 'Кибер-исследователь', description: 'Интересуется безопасностью, данными и цифровой гигиеной.', keywords: ['безопасность', 'privacy', 'кибер', 'данные', 'цифровая гигиена'] },
  { name: 'Исследователь искусственного интеллекта', description: 'Работает с моделями, алгоритмами и автоматизацией.', keywords: ['нейросети', 'машинное обучение', 'алгоритмы', 'ai', 'mlops'] },
  { name: 'Медиа-продюсер', description: 'Создаёт контент, сторителлинг и продюсирует медиапроекты.', keywords: ['контент', 'сторителлинг', 'медиа', 'продюсер', 'интервью'] },
  { name: 'Спорт-наставник', description: 'Ценит здоровье, тренировки и устойчивые привычки.', keywords: ['спорт', 'здоровье', 'тренировки', 'биохакинг', 'привычки'] },
  { name: 'Футурист', description: 'Строит сценарии будущего, анализирует тренды и технологии.', keywords: ['футуризм', 'тренды', 'scenarios', 'будущее', 'прогноз'] },
  { name: 'Системный аналитик', description: 'Любит сложные системы, процессы и оптимизацию.', keywords: ['системы', 'аналитика', 'оптимизация', 'процессы', 'структура'] },
  { name: 'Креативный инженер', description: 'Собирает технические и художественные подходы, делает прототипы.', keywords: ['прототипирование', 'инженерия', 'hardware', 'робототехника', 'дизайн-инжиниринг'] },
];

const baseProfile: PersonalityProfile = {
  name: 'Исследователь',
  description: 'Добавьте интересы, чтобы узнать свой профиль.',
  keywords: [],
};

const sanitizeInterest = (interest: string) => interest.toLowerCase().replace(/[.,!?]/g, '').trim();

export const getPersonality = (interests: string[]): PersonalityProfile => {
  if (!interests.length) return baseProfile;
  const normalized = interests.map(sanitizeInterest).filter(Boolean);
  if (!normalized.length) return baseProfile;

  let best = baseProfile;
  let bestScore = 0;

  for (const profile of personalityProfiles) {
    const hits = profile.keywords.reduce((acc, keyword) => {
      const key = sanitizeInterest(keyword);
      const has = normalized.some((interest) => interest.includes(key) || key.includes(interest));
      return acc + (has ? 1 : 0);
    }, 0);

    if (hits > bestScore || (hits === bestScore && hits > 0 && profile.keywords.length > (best.keywords?.length ?? 0))) {
      best = profile;
      bestScore = hits;
    }
  }

  return bestScore > 0 ? best : baseProfile;
};
